<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ZsffsZ&#39;s Blog</title>
  
  
  <link href="/codes/atom.xml" rel="self"/>
  
  <link href="https://zsffsz.github.io/codes/"/>
  <updated>2019-01-04T18:02:57.761Z</updated>
  <id>https://zsffsz.github.io/codes/</id>
  
  <author>
    <name>ZsffsZ</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>g</title>
    <link href="https://zsffsz.github.io/codes/2018/11/17/g/"/>
    <id>https://zsffsz.github.io/codes/2018/11/17/g/</id>
    <published>2018-11-17T12:30:13.000Z</published>
    <updated>2019-01-04T18:02:57.761Z</updated>
    
    <content type="html"><![CDATA[<h1 id="第一次项目部署"><a href="#第一次项目部署" class="headerlink" title="第一次项目部署"></a>第一次项目部署</h1><p>用的阿里云最便宜的，我自己一个人用用就好。就讲一下我碰到的<br>坑吧。</p><a id="more"></a><h2 id="1-访问不到服务器"><a href="#1-访问不到服务器" class="headerlink" title="1.访问不到服务器"></a>1.访问不到服务器</h2><p>之前买的do服务器，防火墙默认全通过。结果在这里卡了好久，明<br>明可以ssh连到，但是访问不了，就得在防火墙设置里把端口开放了。</p><h2 id="2-vim操作问题"><a href="#2-vim操作问题" class="headerlink" title="2.vim操作问题"></a>2.vim操作问题</h2><p>没用过啊主要是，编辑了文件结果不知道怎么保存。可以上网查一下<br>vim的使用方法以及常用命令。/wq即可</p><h2 id="更多问题有待补充。。"><a href="#更多问题有待补充。。" class="headerlink" title="更多问题有待补充。。"></a>更多问题有待补充。。</h2>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;第一次项目部署&quot;&gt;&lt;a href=&quot;#第一次项目部署&quot; class=&quot;headerlink&quot; title=&quot;第一次项目部署&quot;&gt;&lt;/a&gt;第一次项目部署&lt;/h1&gt;&lt;p&gt;用的阿里云最便宜的，我自己一个人用用就好。就讲一下我碰到的&lt;br&gt;坑吧。&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>f</title>
    <link href="https://zsffsz.github.io/codes/2018/11/11/f/"/>
    <id>https://zsffsz.github.io/codes/2018/11/11/f/</id>
    <published>2018-11-11T14:20:53.000Z</published>
    <updated>2019-01-04T18:32:04.168Z</updated>
    
    <content type="html"><![CDATA[<h1 id="eleme红包修复-最终"><a href="#eleme红包修复-最终" class="headerlink" title="eleme红包修复-最终"></a>eleme红包修复-最终</h1><p>经过长时间努力，终于可以领红包了，就差最后的部署了。<br>然后就是一些算法<br><a id="more"></a></p><h2 id="1-如何判断领红包个数"><a href="#1-如何判断领红包个数" class="headerlink" title="1.如何判断领红包个数"></a>1.如何判断领红包个数</h2><p>这个在url里就可以看到，包括platform之类的参数都有。</p><h2 id="2-如何判断当前个数"><a href="#2-如何判断当前个数" class="headerlink" title="2.如何判断当前个数"></a>2.如何判断当前个数</h2><p>这个在返回的cookie里是有的，不过也是整个算法最烦的地方，<br>每次post请求后返回的数据里，你并不能看到红包还剩几个，</p><p>但是我们可以用前端来判断。</p><p>jquery就很不错，页面上会有写着已经领过的账号，那直接获取<br>有几个，然后做个减法就可以判断了。</p><p>当只剩最后一个的时候，换成我们的手机号，就可以领最大红包了。</p><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div></pre></td><td class="code"><pre><div class="line">var http=require(&quot;http&quot;);</div><div class="line">var fs=require(&quot;fs&quot;);</div><div class="line">var express=require(&quot;express&quot;);</div><div class="line">var request=require(&quot;request&quot;);</div><div class="line">var querystring=require(&quot;querystring&quot;);</div><div class="line">var cookieParser=require(&quot;cookie-parser&quot;);</div><div class="line">var bodyParser=require(&quot;body-parser&quot;);</div><div class="line">var urlp=require(&quot;url&quot;);</div><div class="line">var app=express();</div><div class="line">var ejs=require(&quot;ejs&quot;);</div><div class="line">var cookie=require(&quot;./cookie&quot;);</div><div class="line">var randomPhone=require(&quot;./random-phone&quot;);</div><div class="line">app.engine(&quot;.html&quot;,ejs.__express);</div><div class="line">app.set(&quot;view engine&quot;,&apos;html&apos;);</div><div class="line">app.set(&quot;views&quot;,&apos;./&apos;);</div><div class="line"></div><div class="line">const origin=&quot;https://h5.ele.me&quot;;</div><div class="line"></div><div class="line">var pn=[13962199101,</div><div class="line">    13961021922,</div><div class="line">    18341939461,</div><div class="line">    17614343889,</div><div class="line">    15518501232,</div><div class="line">    13682877584,</div><div class="line">    13521453986,</div><div class="line">    15518353303,</div><div class="line">    13964296965,</div><div class="line">    13005633506];</div><div class="line"></div><div class="line">var url=&quot;&quot;;</div><div class="line">var mobile=&quot;&quot;;</div><div class="line">var query=&quot;&quot;;</div><div class="line"></div><div class="line">app.use(bodyParser.urlencoded(&#123;extended:false&#125;));</div><div class="line">app.use(cookieParser());</div><div class="line">app.get(&quot;/lhb&quot;,(req,res)=&gt;&#123;</div><div class="line">    res.render(&quot;1.html&quot;);</div><div class="line">&#125;);</div><div class="line">app.post(&quot;/hongbao&quot;,(req,res,next)=&gt;&#123;</div><div class="line">    url=req.body.url;</div><div class="line">    if(urlp.parse(url).host==&quot;url.cn&quot;)&#123;</div><div class="line">        request.get(url,function(err,res,body)&#123;</div><div class="line">            url=res.request.uri.href;</div><div class="line">            next();</div><div class="line">        &#125;);</div><div class="line">    &#125;else&#123;</div><div class="line">        next();</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line">app.post(&quot;/hongbao&quot;,(req,res)=&gt;&#123;</div><div class="line">    </div><div class="line">    mobile=req.body.mobile;</div><div class="line">    console.log(req.body);</div><div class="line">    query=querystring.parse(url);</div><div class="line">    var luckyNumber=query.lucky_number;</div><div class="line">    var number=luckyNumber;</div><div class="line">    var temp=0;</div><div class="line">    var rsd=function(i)&#123;</div><div class="line">        res.render(&quot;1.html&quot;,&#123;tt:i&#125;);</div><div class="line">    &#125;</div><div class="line">    var rdt=function()&#123;</div><div class="line">        res.redirect(&quot;/lhb&quot;);</div><div class="line">    &#125;</div><div class="line">    var h=0;</div><div class="line">    function lhb(number)&#123;</div><div class="line">        console.log(query.lucky_number);</div><div class="line">        console.log(temp);</div><div class="line">        console.log(number);</div><div class="line">        if(number==1)&#123;</div><div class="line">            var phone=mobile;</div><div class="line">            var sns=cookie[temp];</div><div class="line">            var putoption=&#123;</div><div class="line">                url:`https://h5.ele.me/restapi/v1/weixin/$&#123;sns.openid&#125;/phone`,</div><div class="line">                headers:&#123;</div><div class="line">                  host:&quot;h5.ele.me&quot;,</div><div class="line">                  &apos;Content-Type&apos;:&apos;application/x-www-form-urlencoded; charset=UTF-8&apos;,  </div><div class="line">                  &apos;X-Shard&apos;:`eosid=$&#123;parseInt(query.sn, 16)&#125;`,</div><div class="line">                  referer: `$&#123;origin&#125;/hongbao/`,</div><div class="line">                  &apos;user-agent&apos;: &apos;Mozilla/5.0 (Linux; Android 6.0; PRO 6 Build/MRA58K; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/53.0.2785.49 Mobile MQQBrowser/6.2 TBS/043221 Safari/537.36 V1_AND_SQ_7.0.0_676_YYB_D QQ/7.0.0.3135 NetType/WIFI WebP/0.3.0 Pixel/1080&apos;</div><div class="line">                &#125;,</div><div class="line">                body:JSON.stringify(&#123;</div><div class="line">                    sign: sns.eleme_key,</div><div class="line">                    phone</div><div class="line">                &#125;)</div><div class="line">            &#125;</div><div class="line">            var postDt=&#123;</div><div class="line">                device_id: &apos;&apos;,</div><div class="line">                group_sn: query.sn,</div><div class="line">                hardware_id: &apos;&apos;,</div><div class="line">                method: &apos;phone&apos;,</div><div class="line">                phone,</div><div class="line">                platform: query.platform,</div><div class="line">                sign: sns.eleme_key,</div><div class="line">                track_id: &apos;&apos;,</div><div class="line">                unionid: &apos;fuck&apos;,</div><div class="line">                weixin_avatar: &apos;&apos;,</div><div class="line">                weixin_username: &apos;&apos;</div><div class="line">            &#125;</div><div class="line">            postDt=querystring.stringify(postDt);</div><div class="line">            var postURL=`https://h5.ele.me/restapi/marketing/promotion/weixin/$&#123;sns.openid&#125;`;</div><div class="line">            var postoption=&#123;</div><div class="line">                url:postURL,</div><div class="line">                headers:&#123;  </div><div class="line">                  &apos;Content-Type&apos;:&apos;application/x-www-form-urlencoded; charset=UTF-8&apos;,  </div><div class="line">                  &apos;Content-Length&apos;:Buffer.byteLength(postDt)</div><div class="line">                &#125;,</div><div class="line">                body:JSON.stringify(postDt)</div><div class="line">            &#125;</div><div class="line">            request.put(putoption,function(err,body) &#123;</div><div class="line">                if(err)&#123;</div><div class="line">                    console.log(err);</div><div class="line">                &#125;else&#123;</div><div class="line">                    request.post(postoption,function(err,res,body)&#123;</div><div class="line">                        if(err)&#123;</div><div class="line">                            console.log(err);</div><div class="line">                        &#125;else&#123;</div><div class="line">                            console.log(JSON.parse(res.body));</div><div class="line">                            console.log(&quot;成功领取&quot;+JSON.parse(res.body).promotion_records[temp].amount+&quot;元&quot;+&quot; &quot;+phone);</div><div class="line">                            rsd(&quot;成功领取&quot;+JSON.parse(res.body).promotion_records[temp].amount+&quot;元&quot;+&quot; &quot;+phone);</div><div class="line">                            //rdt();</div><div class="line">                          return 0;</div><div class="line">                        &#125;</div><div class="line">                    &#125;);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;else&#123;</div><div class="line">            var sns=cookie[temp];</div><div class="line">            var phone=pn[temp];</div><div class="line">            var postDt=&#123;</div><div class="line">                device_id: &apos;&apos;,</div><div class="line">                group_sn: query.sn,</div><div class="line">                hardware_id: &apos;&apos;,</div><div class="line">                method: &apos;phone&apos;,</div><div class="line">                phone,</div><div class="line">                platform: query.platform,</div><div class="line">                sign: sns.eleme_key,</div><div class="line">                track_id: &apos;&apos;,</div><div class="line">                unionid: &apos;fuck&apos;,</div><div class="line">                weixin_avatar: &apos;&apos;,</div><div class="line">                weixin_username: &apos;&apos;</div><div class="line">            &#125;</div><div class="line">            postDt=querystring.stringify(postDt);</div><div class="line">            var putoption=&#123;</div><div class="line">                url:`https://h5.ele.me/restapi/v1/weixin/$&#123;sns.openid&#125;/phone`,</div><div class="line">                headers:&#123;</div><div class="line">                  host:&quot;h5.ele.me&quot;,</div><div class="line">                  &apos;Content-Type&apos;:&apos;application/x-www-form-urlencoded; charset=UTF-8&apos;,  </div><div class="line">                  &apos;X-Shard&apos;:`eosid=$&#123;parseInt(query.sn, 16)&#125;`,</div><div class="line">                  referer: `$&#123;origin&#125;/hongbao/`,</div><div class="line">                  &apos;user-agent&apos;: &apos;Mozilla/5.0 (Linux; Android 6.0; PRO 6 Build/MRA58K; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/53.0.2785.49 Mobile MQQBrowser/6.2 TBS/043221 Safari/537.36 V1_AND_SQ_7.0.0_676_YYB_D QQ/7.0.0.3135 NetType/WIFI WebP/0.3.0 Pixel/1080&apos;</div><div class="line">                &#125;,</div><div class="line">                body:JSON.stringify(&#123;</div><div class="line">                    sign: sns.eleme_key,</div><div class="line">                    phone</div><div class="line">                &#125;)</div><div class="line">            &#125;</div><div class="line">            var postURL=`https://h5.ele.me/restapi/marketing/promotion/weixin/$&#123;sns.openid&#125;`;</div><div class="line">            var postoption=&#123;</div><div class="line">                url:postURL,</div><div class="line">                headers:&#123;  </div><div class="line">                  &apos;Content-Type&apos;:&apos;application/x-www-form-urlencoded; charset=UTF-8&apos;,  </div><div class="line">                  &apos;Content-Length&apos;:Buffer.byteLength(postDt)  </div><div class="line">                &#125;,</div><div class="line">                body:JSON.stringify(postDt)</div><div class="line">            &#125;</div><div class="line">            request.put(putoption,function(err,body) &#123;</div><div class="line">                if(err)&#123;</div><div class="line">                    console.log(err); </div><div class="line">                &#125;else&#123;</div><div class="line">                    request.post(postoption,function(err,res,body)&#123;</div><div class="line">                        if(err)&#123;</div><div class="line">                            console.log(err);</div><div class="line">                        &#125;else&#123;</div><div class="line">                            temp=JSON.parse(res.body).promotion_records.length;</div><div class="line">                            if(temp&gt;=luckyNumber)&#123;</div><div class="line">                                rsd(&quot;已经抢过了&quot;+&quot; &quot;+JSON.parse(res.body).promotion_records[luckyNumber-1].amount+&quot;元 &quot;+JSON.parse(res.body).promotion_records[luckyNumber-1].sns_username);</div><div class="line">                                console.log(&quot;已经抢过了&quot;+&quot; &quot;+JSON.parse(res.body).promotion_records[luckyNumber-1].amount+&quot;元 &quot;+JSON.parse(res.body).promotion_records[luckyNumber-1].sns_username);</div><div class="line">                                return 0;</div><div class="line">                            &#125;</div><div class="line">                            if(temp==0)&#123;</div><div class="line">                                h++;</div><div class="line">                                if(h&gt;=10)&#123;</div><div class="line">                                    rsd(&quot;今日已达上限&quot;);</div><div class="line">                                    return 0;</div><div class="line">                                &#125;</div><div class="line">                            &#125;</div><div class="line">                            number=luckyNumber-temp;</div><div class="line">                            return lhb(number);</div><div class="line">                        &#125;</div><div class="line">                    &#125;);</div><div class="line">                &#125;</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    lhb(number);</div><div class="line">&#125;);</div><div class="line">app.listen(8080);</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;eleme红包修复-最终&quot;&gt;&lt;a href=&quot;#eleme红包修复-最终&quot; class=&quot;headerlink&quot; title=&quot;eleme红包修复-最终&quot;&gt;&lt;/a&gt;eleme红包修复-最终&lt;/h1&gt;&lt;p&gt;经过长时间努力，终于可以领红包了，就差最后的部署了。&lt;br&gt;然后就是一些算法&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>e</title>
    <link href="https://zsffsz.github.io/codes/2018/11/09/e/"/>
    <id>https://zsffsz.github.io/codes/2018/11/09/e/</id>
    <published>2018-11-09T11:40:41.000Z</published>
    <updated>2019-01-04T18:31:06.417Z</updated>
    
    <content type="html"><![CDATA[<h1 id="eleme红包修复3"><a href="#eleme红包修复3" class="headerlink" title="eleme红包修复3"></a>eleme红包修复3</h1><p>上次我们搞定了一次请求的发送，可是执行后并没有多大反应，<br>小的红包也没领取到。那么就先来看看eleme页面的请求方式。<br><a id="more"></a></p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>在开发者模式下可以看到有个302的put请求在我们的post之前。<br>那么我们来看一下这个put请求:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">                url:&apos;https://h5.ele.me/restapi/v1/weixin/phone&apos;,</div><div class="line">                headers:&#123;</div><div class="line">                  host:&quot;h5.ele.me&quot;,</div><div class="line">                  &apos;Content-Type&apos;:&apos;application/x-www-form-urlencoded; charset=UTF-8&apos;,  </div><div class="line">                  &apos;X-Shard&apos;:&apos;eosid=&apos;,</div><div class="line">                  referer: &apos;h5.ele.me/hongbao/&apos;,</div><div class="line">                  &apos;user-agent&apos;: &apos;Mozilla/5.0 (Linux; Android 6.0; PRO 6 Build/MRA58K; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/53.0.2785.49 Mobile MQQBrowser/6.2 TBS/043221 Safari/537.36 V1_AND_SQ_7.0.0_676_YYB_D QQ/7.0.0.3135 NetType/WIFI WebP/0.3.0 Pixel/1080&apos;</div><div class="line">                &#125;,</div><div class="line">                body:</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>这个前置的put请求其实起到一个类似登录的作用(我认为，勿喷)。<br>那我们把他们加起来。<br>但不能直接放在后面，因为我们知道这个nodejs多半是异步操作，<br>请求也必须是异步的。所以把它加到回调函数里:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">requset.put(option,(err)=&gt;&#123;</div><div class="line">    if(!err)&#123;</div><div class="line">        request.post(option,(err,res)=&gt;&#123;</div><div class="line">            //do something</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p><p>这样就完成了。末尾粘贴整个代码。</p><h2 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h2><p>我们知道懒是第一生产力，发十个请求还要这么麻烦，我们完全可以写到一起。<br>当然具体下次说</p><p>首先不可能用for循环，刚刚开始学的我也不会用promise，await等等，那我们<br>想，接受到响应之后再发送不就行了。</p><p>就类似于<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">function getHongbao(ctx)&#123;</div><div class="line">    request.post(option,(err,data)=&gt;&#123;</div><div class="line">        return getHongbao(data);</div><div class="line">    &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><h2 id="核心代码部分"><a href="#核心代码部分" class="headerlink" title="核心代码部分"></a>核心代码部分</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">function lhb(number)&#123;</div><div class="line">            var phone=mobile;</div><div class="line">            var sns=cookie[temp];</div><div class="line">            var putoption=&#123;</div><div class="line">                etc......</div><div class="line">            &#125;</div><div class="line">            var postDt=&#123;</div><div class="line">                etc......</div><div class="line">            &#125;</div><div class="line">            postDt=querystring.stringify(postDt);</div><div class="line">            var postURL=`https://h5.ele.me/restapi/marketing/promotion/weixin/$&#123;sns.openid&#125;`;</div><div class="line">            var postoption=&#123;</div><div class="line">                url:postURL,</div><div class="line">                headers:&#123;  </div><div class="line">                  &apos;Content-Type&apos;:&apos;application/x-www-form-urlencoded; charset=UTF-8&apos;,  </div><div class="line">                  &apos;Content-Length&apos;:Buffer.byteLength(postDt)</div><div class="line">                &#125;,</div><div class="line">                body:JSON.stringify(postDt)</div><div class="line">            &#125;</div><div class="line">            request.put(putoption,function(err,body) &#123;</div><div class="line">                if(err)&#123;</div><div class="line">                    console.log(err);</div><div class="line">                &#125;else&#123;</div><div class="line">                    request.post(postoption,function(err,res,body)&#123;</div><div class="line">                        if(err)&#123;</div><div class="line">                            console.log(err);</div><div class="line">                        &#125;else&#123;</div><div class="line">                            rsd(&quot;成功领取&quot;+JSON.parse(res.body).promotion_records[temp].amount+&quot;元&quot;+&quot; &quot;+phone);</div><div class="line">                          return 0;</div><div class="line">                        &#125;</div><div class="line">                    &#125;);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;eleme红包修复3&quot;&gt;&lt;a href=&quot;#eleme红包修复3&quot; class=&quot;headerlink&quot; title=&quot;eleme红包修复3&quot;&gt;&lt;/a&gt;eleme红包修复3&lt;/h1&gt;&lt;p&gt;上次我们搞定了一次请求的发送，可是执行后并没有多大反应，&lt;br&gt;小的红包也没领取到。那么就先来看看eleme页面的请求方式。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>d</title>
    <link href="https://zsffsz.github.io/codes/2018/11/08/d/"/>
    <id>https://zsffsz.github.io/codes/2018/11/08/d/</id>
    <published>2018-11-08T07:10:21.000Z</published>
    <updated>2019-01-04T18:31:19.409Z</updated>
    
    <content type="html"><![CDATA[<h1 id="eleme红包修复2"><a href="#eleme红包修复2" class="headerlink" title="eleme红包修复2"></a>eleme红包修复2</h1><p>上次我们发现了解题思路，那我们就来实现它。<br>所以源代码应该保持不变，稍微在账号方面改<br>变一下即可。<br><a id="more"></a></p><h2 id="begin"><a href="#begin" class="headerlink" title="begin"></a>begin</h2><p>不过由于官方代码结构过于复杂，仅仅只是一个<br>请求是不用这么复杂的。所以我决定自己写一个。</p><p>首先要解析发送了什么请求，我们来看一下领<br>红包页面的请求体:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">      device_id: &apos;&apos;,</div><div class="line">      group_sn: query.sn,</div><div class="line">      hardware_id: &apos;&apos;,</div><div class="line">      method: &apos;phone&apos;,</div><div class="line">      phone,</div><div class="line">      platform: query.platform,</div><div class="line">      sign: sns.eleme_key,</div><div class="line">      track_id: &apos;&apos;,</div><div class="line">      unionid: &apos;fuck&apos;, </div><div class="line">      weixin_avatar: &apos;&apos;,</div><div class="line">      weixin_username: &apos;&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>这个fuck是工作人员的恶意吗233，我们先不管这么多<br>，我们可以看到group_sn是cookie里的，platform<br>和eleme_key也是cookie里的。只有一个让我们输入<br>的是phone.</p><p>???</p><p>我记得可以用qq注册的，那手机号不是没有吗。<br>于是我又解析了一下cookie：</p><p>里面有个userinfo和eleme_key，而key里的后面半段<br>是我的qq号。<br>整段cookie没有手机号，如果没有加密的话。</p><p>那么很显然，手机号可有可无，也就是可以伪造。</p><h2 id="after"><a href="#after" class="headerlink" title="after"></a>after</h2><p>找了几个qq号后，分别在饿了么注册，获取它们的cookie，<br>那么手机号不可能是12345678900吧，基础的构成方式肯定<br>有检验。<br>那么我们就按照构成方法随机出来几个<br>然后就是请求<br>主要代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">request.post(postoption,function(err,res,body)&#123;</div><div class="line">    if(err)&#123;</div><div class="line">        console.log(err);</div><div class="line">    &#125;else&#123;</div><div class="line">        console.log(JSON.parse(res.body));</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p><p>这样就可以发送一次请求了</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;eleme红包修复2&quot;&gt;&lt;a href=&quot;#eleme红包修复2&quot; class=&quot;headerlink&quot; title=&quot;eleme红包修复2&quot;&gt;&lt;/a&gt;eleme红包修复2&lt;/h1&gt;&lt;p&gt;上次我们发现了解题思路，那我们就来实现它。&lt;br&gt;所以源代码应该保持不变，稍微在账号方面改&lt;br&gt;变一下即可。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>c</title>
    <link href="https://zsffsz.github.io/codes/2018/11/07/c/"/>
    <id>https://zsffsz.github.io/codes/2018/11/07/c/</id>
    <published>2018-11-07T05:50:41.000Z</published>
    <updated>2019-01-04T18:31:26.663Z</updated>
    
    <content type="html"><![CDATA[<h1 id="关于饿了么领红包修复"><a href="#关于饿了么领红包修复" class="headerlink" title="关于饿了么领红包修复"></a>关于饿了么领红包修复</h1><h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>这个应该用过的人非常多，但自从今年上半年他们改了<br>验证码，那个在github上的人也没有继续更新代码，<br>于是我们可不可以自己手动修复呢?<br><a id="more"></a></p><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p>让我白手起家显然是不可能的，毕竟也是小白，所以还是<br>要借助源代码。<br>为了节省时间，我把核心代码贴出来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">await request.put(`/restapi/v1/weixin/$&#123;sns.openid&#125;/phone`, &#123;</div><div class="line">      sign: sns.eleme_key,</div><div class="line">      phone</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p><p>本来之前我也什么都看不懂，但到了这里应该很明确<br>了，其实就是发送一个手机号的请求。</p><p>那怎么会失效呢，我们看看官方解释:<br>由于限制手机每天领取的数量上限以及一些其他原因。</p><p>那就很明白了，手机号不够。或者说是账号不够。</p><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>只需要解决账号问题即可，但现在限制一机一号，很难<br>造出大量的手机号。那我们可以用第三方的qq号来代替<br>，而网络上的一些僵尸号非常多，我们完全可以创造出<br>大量的账号。具体实现将在以后写出。</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;关于饿了么领红包修复&quot;&gt;&lt;a href=&quot;#关于饿了么领红包修复&quot; class=&quot;headerlink&quot; title=&quot;关于饿了么领红包修复&quot;&gt;&lt;/a&gt;关于饿了么领红包修复&lt;/h1&gt;&lt;h2 id=&quot;起因&quot;&gt;&lt;a href=&quot;#起因&quot; class=&quot;headerlink&quot; title=&quot;起因&quot;&gt;&lt;/a&gt;起因&lt;/h2&gt;&lt;p&gt;这个应该用过的人非常多，但自从今年上半年他们改了&lt;br&gt;验证码，那个在github上的人也没有继续更新代码，&lt;br&gt;于是我们可不可以自己手动修复呢?&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>b</title>
    <link href="https://zsffsz.github.io/codes/2018/11/04/b/"/>
    <id>https://zsffsz.github.io/codes/2018/11/04/b/</id>
    <published>2018-11-04T15:54:21.000Z</published>
    <updated>2019-01-04T18:31:43.910Z</updated>
    
    <content type="html"><![CDATA[<h1 id="碰到的第一个问题"><a href="#碰到的第一个问题" class="headerlink" title="碰到的第一个问题:"></a>碰到的第一个问题:</h1><h2 id="比如如下代码获取到一个json"><a href="#比如如下代码获取到一个json" class="headerlink" title="比如如下代码获取到一个json"></a>比如如下代码获取到一个json</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">let data=getDetails(ctx);</div><div class="line">data.name;//得到的是undefined</div></pre></td></tr></table></figure><a id="more"></a><h2 id="思考"><a href="#思考" class="headerlink" title="思考:"></a>思考:</h2><p>加上一句<br><code>data = eval(&#39;(&#39;+data+&#39;)&#39;);</code></p><h2 id="原因"><a href="#原因" class="headerlink" title="原因:"></a>原因:</h2><p>一般返回的是一串字符串，所以不能直接使用，<br>可以用eval()将字符串转换为json对象。</p><h2 id="问题2"><a href="#问题2" class="headerlink" title="问题2:"></a>问题2:</h2><p>那为什么要加这中间这一串<br>其实可以看这一个输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">console.log(eval(&apos;&#123;&#125;&apos;))//undefined</div><div class="line"></div><div class="line">console.log(eval(&apos;(&#123;&#125;)&apos;))//Object[object]</div></pre></td></tr></table></figure></p><p>由于eval是执行这段代码，而{}是默认加在头尾的所以要加()</p><h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><p>但是其实更建议使用JSON.parse();<br>当时脑子抽了给忘了</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;碰到的第一个问题&quot;&gt;&lt;a href=&quot;#碰到的第一个问题&quot; class=&quot;headerlink&quot; title=&quot;碰到的第一个问题:&quot;&gt;&lt;/a&gt;碰到的第一个问题:&lt;/h1&gt;&lt;h2 id=&quot;比如如下代码获取到一个json&quot;&gt;&lt;a href=&quot;#比如如下代码获取到一个json&quot; class=&quot;headerlink&quot; title=&quot;比如如下代码获取到一个json&quot;&gt;&lt;/a&gt;比如如下代码获取到一个json&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;let data=getDetails(ctx);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;data.name;//得到的是undefined&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>a</title>
    <link href="https://zsffsz.github.io/codes/2018/10/24/a/"/>
    <id>https://zsffsz.github.io/codes/2018/10/24/a/</id>
    <published>2018-10-24T11:46:35.000Z</published>
    <updated>2019-01-04T15:53:14.506Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-This-is-the-first-page"><a href="#1-This-is-the-first-page" class="headerlink" title="1.  This is the first page"></a>1.  This is the first page</h1><h2 id="1-first"><a href="#1-first" class="headerlink" title="1. first"></a>1. <a href="#first">first</a></h2><h2 id="2-second"><a href="#2-second" class="headerlink" title="2. second"></a>2. <a href="#second">second</a></h2><h2 id="3-third"><a href="#3-third" class="headerlink" title="3. third"></a>3. <a href="#third">third</a></h2><h2 id="4-xjbd"><a href="#4-xjbd" class="headerlink" title="4. xjbd"></a>4. <a href="#forth">xjbd</a></h2><h2 id=""><a href="#" class="headerlink" title=""></a><a id="more"></a></h2><h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h1><hr><h1 id="2-分类"><a href="#2-分类" class="headerlink" title="2. 分类"></a>2. 分类</h1><hr><h1 id="3-基础"><a href="#3-基础" class="headerlink" title="3. 基础"></a>3. 基础</h1><hr><table><thead><tr><th style="text-align:right">数字</th><th style="text-align:center">方向</th><th style="text-align:left">简写</th></tr></thead><tbody><tr><td style="text-align:right">2</td><td style="text-align:center">下</td><td style="text-align:left">2</td></tr><tr><td style="text-align:right">4</td><td style="text-align:center">后</td><td style="text-align:left">4</td></tr><tr><td style="text-align:right">6</td><td style="text-align:center">前</td><td style="text-align:left">6</td></tr><tr><td style="text-align:right">8</td><td style="text-align:center">上</td><td style="text-align:left">8</td></tr><tr><td style="text-align:right">3</td><td style="text-align:center">下前一起</td><td style="text-align:left">3</td></tr></tbody></table><hr>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;1-This-is-the-first-page&quot;&gt;&lt;a href=&quot;#1-This-is-the-first-page&quot; class=&quot;headerlink&quot; title=&quot;1.  This is the first page&quot;&gt;&lt;/a&gt;1.  This is the first page&lt;/h1&gt;&lt;h2 id=&quot;1-first&quot;&gt;&lt;a href=&quot;#1-first&quot; class=&quot;headerlink&quot; title=&quot;1. first&quot;&gt;&lt;/a&gt;1. &lt;a href=&quot;#first&quot;&gt;first&lt;/a&gt;&lt;/h2&gt;&lt;h2 id=&quot;2-second&quot;&gt;&lt;a href=&quot;#2-second&quot; class=&quot;headerlink&quot; title=&quot;2. second&quot;&gt;&lt;/a&gt;2. &lt;a href=&quot;#second&quot;&gt;second&lt;/a&gt;&lt;/h2&gt;&lt;h2 id=&quot;3-third&quot;&gt;&lt;a href=&quot;#3-third&quot; class=&quot;headerlink&quot; title=&quot;3. third&quot;&gt;&lt;/a&gt;3. &lt;a href=&quot;#third&quot;&gt;third&lt;/a&gt;&lt;/h2&gt;&lt;h2 id=&quot;4-xjbd&quot;&gt;&lt;a href=&quot;#4-xjbd&quot; class=&quot;headerlink&quot; title=&quot;4. xjbd&quot;&gt;&lt;/a&gt;4. &lt;a href=&quot;#forth&quot;&gt;xjbd&lt;/a&gt;&lt;/h2&gt;&lt;h2 id=&quot;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title=&quot;&quot;&gt;&lt;/a&gt;
    
    </summary>
    
    
  </entry>
  
</feed>
